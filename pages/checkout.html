<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container my-5">
        <h2 class="mb-4">Checkout</h2>

        <div id="order-summary" class="mb-4"></div>

        <form id="checkout-form">
            <div class="mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Shipping Address</label>
                <textarea class="form-control" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Place Order</button>
        </form>
    </div>

    <script>
        function loadSummary() {
            let ecommerceData = JSON.parse(localStorage.getItem("ecommerceData"));
            let loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));

            let userCart = ecommerceData.cart.find(c => c.userId == loggedInUser.id);
            let data = userCart ? userCart.items : [];            let summaryHTML = "<h4>Order Summary</h4><ul class='list-group'>";
            let total = 0;

            data.forEach(item => {
                let product = ecommerceData.products.find(p => p.id == item.productId);
                let price = product.discount ? product.price - product.price * (product.discount / 100) : product.price
                total += price * item.quantity;
                summaryHTML += `<li class="list-group-item d-flex justify-content-between">
      ${product.name} x ${item.quantity}
      <span>$${(price * item.quantity).toFixed(2)}</span>
    </li>`;
            });

            summaryHTML += `</ul><h5 class="mt-3">Total: $${total.toFixed(2)}</h5>`;

            if (data.length === 0) {
                summaryHTML = "<p>Your cart is empty.</p>";
            }

            document.getElementById("order-summary").innerHTML = summaryHTML;
        }

        document.getElementById("checkout-form").addEventListener("submit", function (e) {
            e.preventDefault();
            alert("Order placed successfully!");
            localStorage.removeItem("ecommerceData");
            window.location.href = "cart.html";
        });

        loadSummary();
    </script>
</body>

</html>