<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home</title>

  <link rel="stylesheet" href="./home.css" />
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./home.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script src="../js/initData.js"></script>
</head>

<body>


  <div id="black">
    <a href="#">Summer Sale For All Swim Suits And Free Express Delivery - OFF 50%! <span>Shop Now</span></a>
  </div>


  <div class="nav-wrapper">
    <nav class="navbar navbar-expand-lg navbar-light bg-white py-3 px-5">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="./homepage.html">Exclusive</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="../pages/shop.html">Shop</a></li>
            <li class="nav-item"><a class="nav-link" href="../pages/about.html">About</a></li>
            <li class="nav-item"><a class="nav-link" href="../pages/contact.html">Contact</a></li>
          </ul>

          <form class="d-flex align-items-center">
            <input class="form-control me-2" type="search" placeholder="Search products..." />
            <button class="btn btn-outline-secondary me-3" type="submit">
              <i class="fas fa-search"></i>
            </button>
            <a href="#" class="text-dark me-3"><i class="fas fa-heart fs-5"></i></a>
            <a href="#" class="text-dark"><i class="fas fa-shopping-cart fs-5"></i></a>
          </form>
        </div>
      </div>
    </nav>
  </div>


  <div class="main-wrapper">
    <div id="sidebar" class="p-3"></div>
    <div class="landing">
      <img alt="" src="./imgs/landing.png" />
    </div>
  </div>


  <section>
    <div class="Flash text-center ">
      <div class="title d-flex justify-content-start align-items-center">
        <span>Today's</span>
      </div>
      <h1 class="d-flex justify-content-start align-items-center">Flash Sales</h1>
      <div class="carousel-controls">
        <button class="btn prev" type="button" data-bs-target="#flashCarousel1" data-bs-slide="prev">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="btn next" type="button" data-bs-target="#flashCarousel1" data-bs-slide="next">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <div id="flashCarousel1" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner my-3"></div>
        <button class="btn btn-danger fs-5 mx-auto d-block  my-2" style="height: 4rem; width:15rem;">View All Products</button>
      </div>
    </div>
  </section>


  <section style="height: 60vh;">
    <div class="Flash">
      <div class="title d-flex justify-content-start align-items-center">
        <span>Categories</span>
      </div>
      <h1 class="d-inline-block justify-content-start">Browse By Category</h1>
      <div id="categoriesContainer" class="cards d-flex m-2"></div>
    </div>
  </section>


  <section>
    <div class="Flash ">
      <div class="title d-flex justify-content-start align-items-center">
        <span>This Month</span>
      </div>
      <div class="d-flex justify-content-between align-items-center ">
        <h1 class=" d-inline-block justify-content-start">Best Selling Products</h1>
        <button class=" btn btn-danger fs-5 d-inline-block my-2" style="height: 4rem; width:15rem;">View All Products</button>
      </div>
      <div class="carousel-controls">
        <button class="btn prev" type="button" data-bs-target="#flashCarousel2" data-bs-slide="prev">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="btn next" type="button" data-bs-target="#flashCarousel2" data-bs-slide="next">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <div id="flashCarousel2" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner my-3"></div>
      </div>
    </div>
  </section>

  
  <footer class="footer bg-black text-white pt-5 pb-3 overflow-hidden">
    <div class="container">

    </div>
  </footer>


  <script>
    const data = JSON.parse(localStorage.getItem("ecommerceData")) || { products: [] };
    const products = data.products;

    const categories = [...new Set(products.map(p => p.category))];

    const container = document.getElementById("categoriesContainer");
    const sidebar = document.getElementById("sidebar");

    const icons = {
      "Electronics": '<i class="fas fa-mobile me-2"></i>',
      "Men's Fashion": '<i class="fas fa-tshirt me-2"></i>',
      "Women\'s Fashion": '<i class="fas fa-female me-2"></i>',
      "Furniture": '<i class="fas fa-couch me-2"></i>',
      "Toys": '<i class="fas fa-gamepad me-2"></i>'
    };

    const subCategories = {
      "Women's Fashion": ["Dresses", "Shoes", "Accessories"],
      "Electronics": ["Mobiles", "Laptops", "Accessories"]
    };

    function goToCategory(categoryName, subName = "") {
      categoryName = decodeURIComponent(categoryName);
      let url = `../pages/shop.html?category=${encodeURIComponent(categoryName)}`;
      if (subName) url += `&sub=${encodeURIComponent(subName)}`;
      window.location.href = url;
    }


    sidebar.innerHTML = "";
    categories.forEach(cat => {
      const hasSub = subCategories[cat];
      const icon = icons[cat] || '<i class="fas fa-tag me-2"></i>';
      sidebar.innerHTML += `
        <a href="#" class="d-flex justify-content-between align-items-center mb-2 category-link" data-cat="${encodeURIComponent(cat)}">
          <span>${icon} ${cat}</span>
          ${hasSub ? '<i class="fas fa-chevron-right"></i>' : ""}
        </a>
        ${hasSub ? `
          <div class="submenu" style="display:none;">
            ${subCategories[cat].map(sub => `<a href="#" class="sub-link" data-cat="${encodeURIComponent(cat)}" data-sub="${encodeURIComponent(sub)}">${sub}</a>`).join("")}
          </div>
        ` : ""}
      `;
    });

    document.querySelectorAll("#sidebar .category-link").forEach(link => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const submenu = this.nextElementSibling;
        const chevron = this.querySelector("i.fas.fa-chevron-right, i.fas.fa-chevron-down");
        if (submenu && submenu.classList.contains("submenu") && e.target === chevron) {
          const isOpen = submenu.style.display === "block";
          submenu.style.display = isOpen ? "none" : "block";
          if (chevron) {
            chevron.classList.toggle("fa-chevron-right", isOpen);
            chevron.classList.toggle("fa-chevron-down", !isOpen);
          }
        } else {
          goToCategory(this.dataset.cat);
        }
      });
    });

    document.querySelectorAll("#sidebar .sub-link").forEach(link => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        goToCategory(this.dataset.cat, this.dataset.sub);
      });
    });


    categories.forEach(cat => {
      const icon = icons[cat] || '<i class="fas fa-tag"></i>';
      container.innerHTML += `
        <div class="mycard" onclick="goToCategory('${encodeURIComponent(cat)}')">
          ${icon}
          <span>${cat}</span>
        </div>
      `;
    });


    function renderCarousel(carouselId, items) {
      const carouselInner = document.querySelector(`${carouselId} .carousel-inner`);
      carouselInner.innerHTML = "";
      for (let i = 0; i < items.length; i += 4) {
        const chunk = items.slice(i, i + 4);
        const activeClass = i === 0 ? "active" : "";
        let cardsHTML = "";
        chunk.forEach(p => {
          cardsHTML += `
            <div class="product-card">
              <img src="../assets/images/products/${p.imageUrl}" alt="${p.name}" onerror="this.src='../assets/images/products/placeholder.jpg'">
              <h4>${p.name}</h4>
              <h6>$${p.price}</h6>
            </div>
          `;
        });
        carouselInner.innerHTML += `
          <div class="carousel-item ${activeClass}">
            <div class="d-flex">
              ${cardsHTML}
            </div>
          </div>
        `;
      }
    }

    const flashSales = products.filter(p => p.discount > 0).slice(0, 12);
    const bestSelling = [...products].sort((a, b) => b.soldCount - a.soldCount).slice(0, 12);

    renderCarousel("#flashCarousel1", flashSales);
    renderCarousel("#flashCarousel2", bestSelling);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
