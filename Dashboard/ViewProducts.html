<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; background:#fff; border-radius:10px; overflow:hidden; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; overflow: hidden; text-overflow: ellipsis; word-wrap: break-word; }
    th { background: #007bff; color: #fff; }
    img { border-radius: 8px; }
    .status-badge { padding: 5px 10px; border-radius: 5px; color: #fff; font-weight: bold; text-transform: capitalize; }
    .status-discount { background: #2ecc71; }
    .status-nodiscount { background: #7f8c8d; }
    .action-btn { padding: 5px 10px; margin: 2px; border-radius: 5px; border: none; color: #fff; cursor: pointer; font-size:14px; }
    .edit-btn { background: #3498db; }
    .delete-btn { background: #e74c3c; }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-box"></i> Products</h1>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Discount</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="productsTableBody"></tbody>
    </table>
  </div>

<script>
const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser")) || { role: "admin" };
let ecommerceData = JSON.parse(localStorage.getItem("ecommerceData")) || { products: [] };
let allProducts = ecommerceData.products;

let visibleProducts = loggedInUser.role === "seller"
  ? allProducts.filter(p => p.sellerId === loggedInUser.id)
  : allProducts;

renderProducts("productsTableBody", visibleProducts);

function renderProducts(containerId, products) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  if (!products.length) {
    container.innerHTML = `<tr><td colspan="6">No products found</td></tr>`;
    return;
  }

  products.forEach((p, index) => {
    const imageSrc = p.imageUrl && p.imageUrl.startsWith("data:")
      ? p.imageUrl
      : `../assets/images/products/${p.imageUrl || "default.png"}`;

    container.innerHTML += `
      <tr>
        <td>${index + 1}</td>
        <td><img src="${imageSrc}" alt="${p.name}" style="width:80px; height:80px; object-fit:cover;"></td>
        <td>${p.name}</td>
        <td class="fw-bold">$${p.price}</td>
        <td>
          <span class="status-badge ${p.discount > 0 ? "status-discount" : "status-nodiscount"}">
            ${p.discount > 0 ? `-${p.discount}%` : "No Discount"}
          </span>
        </td>
        <td>
          ${showControlButtons(p)}
        </td>
      </tr>
    `;
  });
}

function showControlButtons(product) {
  if (loggedInUser.role === "admin" || (loggedInUser.role === "seller" && product.sellerId === loggedInUser.id)) {
    return `
      <button class="action-btn edit-btn" onclick="editProduct(${product.id})"><i class="fas fa-edit"></i> Edit</button>
      <button class="action-btn delete-btn" onclick="deleteProduct(${product.id})"><i class="fas fa-trash"></i> Delete</button>
    `;
  }
  return "-";
}

function deleteProduct(productId) {
  if (!confirm("Are you sure you want to delete this product?")) return;
  ecommerceData.products = ecommerceData.products.filter(p => p.id !== productId);
  localStorage.setItem("ecommerceData", JSON.stringify(ecommerceData));
  alert("Product deleted successfully");
  location.reload();
}

function editProduct(productId) {
  localStorage.setItem("editProductId", productId);
  window.location.href = "./Edit.html";
}
</script>
</body>
</html>
