<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Product</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light py-4">

<div class="container">
  <div class="card shadow-lg p-4">
    <h2 class="text-center mb-4">Edit Product</h2>

    <input type="hidden" id="productId">

    <div class="mb-3">
      <label class="form-label fw-bold">Product Name:</label>
      <input type="text" id="productName" class="form-control">
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Category:</label>
      <input type="text" id="productCategory" class="form-control">
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Price:</label>
      <input type="number" id="productPrice" class="form-control">
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Stock:</label>
      <input type="number" id="productStock" class="form-control">
    </div>

    <button id="updateProduct" class="btn btn-primary w-100">Save Changes</button>
  </div>
</div>

<script>
const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!loggedInUser || (loggedInUser.role !== "seller" && loggedInUser.role !== "admin")) {
    alert("You are not authorized to edit products.");
    window.location.href = "../auth/login.html";
}
const productId = parseInt(localStorage.getItem("editProductId"));


let data = JSON.parse(localStorage.getItem("ecommerceData")) || { products: [] };
let products = data.products || [];
let product = products.find(p => p.id === productId);

if (!product) {
    alert("Product not found");
    window.location.href = "./ViewProducts.html";
}

if (loggedInUser.role === "seller" && product.sellerId !== loggedInUser.id) {
    alert("You are not allowed to edit this product.");
    window.location.href = "./ViewProducts.html";
}

document.getElementById("productId").value = product.id;
document.getElementById("productName").value = product.name;
document.getElementById("productCategory").value = product.category;
document.getElementById("productPrice").value = product.price;
document.getElementById("productStock").value = product.stock;

document.getElementById("updateProduct").addEventListener("click", function() {
    product.name = document.getElementById("productName").value.trim();
    product.category = document.getElementById("productCategory").value.trim();
    product.price = parseFloat(document.getElementById("productPrice").value);
    product.stock = parseInt(document.getElementById("productStock").value);

    localStorage.setItem("ecommerceData", JSON.stringify(data));
    alert("Product updated successfully");
    window.location.href = "./ViewProducts.html";
});
</script>

</body>
</html>
